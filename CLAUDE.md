# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Development Commands

**Essential Commands:**
```bash
npm run dev      # Start development server at http://localhost:3000
npm run build    # Build production version  
npm run start    # Start production server
npm run lint     # Run ESLint for code quality
```

**Testing:** No test framework is currently configured. Check with user before adding testing capabilities.

## Architecture Overview

This is a **Next.js 14 PWA** (Progressive Web App) that provides a Gemini AI-powered personal assistant optimized for iPhone. Key architectural decisions:

### Core Technologies
- **Frontend:** Next.js 14 with App Router, TypeScript, Tailwind CSS
- **AI Integration:** Google Gemini API (2.5-pro, 2.5-flash, 2.5-flash-lite models)
- **PWA Features:** Service Worker, offline capabilities, installable on mobile
- **State Management:** React hooks with localStorage persistence
- **Deployment:** Vercel and Docker (for Synology NAS)

### Key Design Patterns

**Mobile-First Architecture:**
- iPhone-optimized PWA with portrait orientation focus
- Touch-friendly UI with safe area handling
- LINE-style chat interface with speech bubbles

**Client-Side State Management:**
- `useChat` hook manages chat sessions and message state
- `useSettings` hook handles Gemini API configuration
- Local storage persistence for chat history and settings

**API Architecture:**
- Next.js API route at `/api/chat/route.ts` proxies requests to Gemini API
- Client-side streaming simulation for better UX
- Comprehensive error handling with Japanese error messages

## Project Structure

```
src/
├── app/
│   ├── layout.tsx          # PWA metadata, viewport config
│   ├── page.tsx            # Main chat page
│   └── api/chat/           # Gemini API proxy
├── components/
│   ├── ChatInterface.tsx   # Main chat UI with mobile optimization
│   ├── MessageBubble.tsx   # Speech bubble messages
│   ├── InputArea.tsx       # Text input with touch optimization
│   ├── SettingsModal.tsx   # API key configuration
│   └── ChatHistoryModal.tsx # Session management
├── hooks/
│   ├── useChat.ts          # Chat state & Gemini API integration
│   └── useSettings.ts      # Configuration management
├── lib/
│   ├── gemini-client.ts    # Gemini API client with model switching
│   ├── storage.ts          # localStorage utilities
│   ├── system-prompt.ts    # AI character definition
│   └── utils.ts            # PWA detection, notifications
└── types/index.ts          # TypeScript definitions
```

## Important Implementation Details

**Gemini API Integration:**
- Supports 3 models: gemini-2.5-pro, gemini-2.5-flash, gemini-2.5-flash-lite
- System prompt creates a Japanese maid character persona
- API key validation: must start with "AIza" and be >10 characters
- Safety settings configured to "BLOCK_NONE" for flexibility

**PWA Configuration:**
- Manifest at `/public/manifest.json` with mobile icons
- Service Worker auto-generated by Next.js
- Apple-specific meta tags in layout.tsx for iOS optimization

**Data Persistence:**
- Chat sessions stored in localStorage with auto-titles
- Settings persisted across sessions
- No backend database - fully client-side

**Mobile Optimization:**
- Tailwind classes use safe area insets (`pt-safe-top`, `h-screen-safe`)
- Touch-optimized buttons with active scale animations
- Gradient backgrounds and glassmorphism effects

## Development Considerations

**Character/Persona:** The AI is configured as a dedicated Japanese maid character. This is intentional and should be preserved.

**Language:** Primary language is Japanese. Error messages, UI text, and system prompts are in Japanese.

**API Keys:** Never commit API keys. The app expects users to input their own Gemini API key via settings.

**Mobile Testing:** Always test on actual iPhone devices or simulator - PWA behavior differs significantly from desktop.

**Docker Deployment:** Configured for Synology NAS deployment with port 3001. See DEPLOYMENT.md for details.

## Common Tasks

**Adding New Gemini Models:** Update `GEMINI_MODELS` object in `gemini-client.ts` and corresponding TypeScript types.

**UI Modifications:** Follow existing Tailwind patterns. Use mobile-first responsive design with touch-friendly sizing.

**Error Handling:** Add Japanese error messages. Use `showNotification` utility for user feedback.

**Settings Changes:** Extend `AppSettings` interface and update `useSettings` hook. Ensure localStorage compatibility.