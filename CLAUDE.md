# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Development Commands

**Essential Commands:**
```bash
npm run dev      # Start development server at http://localhost:3000
npm run build    # Build production version
npm run start    # Start production server
npm run lint     # Run ESLint for code quality
```

**Testing:** No test framework is currently configured. Check with user before adding testing capabilities.

## Architecture Overview

This is a **Next.js 14 PWA** (Progressive Web App) that provides an AI-powered mock interview practice app optimized for iPhone. Key architectural decisions:

### Core Technologies
- **Frontend:** Next.js 14 with App Router, TypeScript, Tailwind CSS
- **AI Integration:** Google Gemini API (2.5-pro, 2.5-flash, 2.5-flash-lite models)
- **PWA Features:** Service Worker, offline capabilities, installable on mobile
- **State Management:** React hooks with localStorage persistence
- **Resume Management:** TypeScript-based resume definitions
- **Deployment:** Vercel and Docker (for Synology NAS)

### Key Design Patterns

**Mobile-First Architecture:**
- iPhone-optimized PWA with portrait orientation focus
- Touch-friendly UI with safe area handling
- LINE-style chat interface for interview conversations

**Resume-Based Interview System:**
- TypeScript resume definitions in `src/resumes/`
- Dynamic system prompt generation based on selected resume
- Consistent character responses based on resume content

**Client-Side State Management:**
- `useChat` hook manages interview sessions and message state
- `useSettings` hook handles Gemini API configuration and resume selection
- Local storage persistence for interview history and settings

**API Architecture:**
- Next.js API route at `/api/chat/route.ts` proxies requests to Gemini API
- Dynamic system prompt injection based on selected resume
- Client-side streaming simulation for better UX
- Comprehensive error handling with Japanese error messages

## Project Structure

```
src/
├── app/
│   ├── layout.tsx          # PWA metadata, viewport config
│   ├── page.tsx            # Main chat page
│   └── api/chat/           # Gemini API proxy
├── components/
│   ├── ChatInterface.tsx   # Main interview UI with mobile optimization
│   ├── MessageBubble.tsx   # Speech bubble messages
│   ├── InputArea.tsx       # Text input with touch optimization
│   ├── SettingsModal.tsx   # API key and resume selection
│   └── ChatHistoryModal.tsx # Interview session management
├── hooks/
│   ├── useChat.ts          # Interview session state & Gemini API integration
│   └── useSettings.ts      # Configuration and resume management
├── lib/
│   ├── gemini-client.ts    # Gemini API client with dynamic system prompts
│   ├── storage.ts          # localStorage utilities
│   ├── system-prompt.ts    # Interview prompt generation
│   └── utils.ts            # PWA detection, notifications
├── resumes/
│   ├── index.ts            # Resume management utilities
│   ├── entry-level-engineer.ts # Sample junior developer resume
│   └── senior-engineer.ts  # Sample senior developer resume
└── types/index.ts          # TypeScript definitions including Resume interface
```

## Important Implementation Details

**Gemini API Integration:**
- Supports 3 models: gemini-2.5-pro, gemini-2.5-flash, gemini-2.5-flash-lite
- Dynamic system prompt generation based on selected resume
- API key validation: must start with "AIza" and be >10 characters
- Safety settings configured to "BLOCK_NONE" for flexibility

**PWA Configuration:**
- Manifest at `/public/manifest.json` with mobile icons
- Service Worker auto-generated by Next.js
- Apple-specific meta tags in layout.tsx for iOS optimization

**Resume System:**
- Resume data stored as TypeScript files in `src/resumes/`
- Dynamic loading and system prompt generation
- Type-safe resume definitions with comprehensive data structure

**Data Persistence:**
- Interview sessions stored in localStorage with auto-titles
- Settings and resume selection persisted across sessions
- No backend database - fully client-side

**Mobile Optimization:**
- Tailwind classes use safe area insets (`pt-safe-top`, `h-screen-safe`)
- Touch-optimized buttons with active scale animations
- Gradient backgrounds and glassmorphism effects

## Development Considerations

**Interview System:** The AI acts as an interview candidate based on the selected resume. Each resume file defines a complete professional background that the AI uses to respond consistently throughout the interview.

**Language:** Primary language is Japanese. Error messages, UI text, and system prompts are in Japanese.

**API Keys:** Never commit API keys. The app expects users to input their own Gemini API key via settings.

**Mobile Testing:** Always test on actual iPhone devices or simulator - PWA behavior differs significantly from desktop.

**Docker Deployment:** Configured for Synology NAS deployment with port 3001. See DEPLOYMENT.md for details.

## Common Tasks

**Adding New Resumes:** Create new TypeScript files in `src/resumes/` following the existing patterns. Update `AVAILABLE_RESUMES` array in `src/resumes/index.ts`.

**Adding New Gemini Models:** Update `GEMINI_MODELS` object in `gemini-client.ts` and corresponding TypeScript types.

**UI Modifications:** Follow existing Tailwind patterns. Use mobile-first responsive design with touch-friendly sizing.

**Error Handling:** Add Japanese error messages. Use `showNotification` utility for user feedback.

**Settings Changes:** Extend `AppSettings` interface and update `useSettings` hook. Ensure localStorage compatibility.

**Interview Prompt Tuning:** Modify `generateInterviewPrompt` function in `system-prompt.ts` to adjust AI behavior and response style.