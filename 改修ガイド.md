# 🔧 アプリ改修ガイド - 別の指導練習用への転用方法

このドキュメントでは、現在の「保健指導シミュレーション」アプリを、別の指導練習用（例：乳幼児検診、栄養指導、禁煙指導など）に改修する手順を説明します。

## 📋 改修の全体像

このアプリは以下の3つの要素で構成されています：

1. **シナリオデータ** - 対象者（患者）のプロフィールや設定
2. **AIプロンプト** - AIの振る舞いを定義する指示
3. **UI/テキスト** - 画面に表示される文言やアイコン

これらを新しいドメインに合わせて置き換えることで、別の指導練習用アプリに改修できます。

---

## 🎯 改修手順

### ステップ1: 型定義の修正（データ構造の設計）

**ファイル**: `src/types/index.ts`

現在の `HealthGuidanceScenario` 型を、新しいドメインに合わせて修正します。

#### 例：乳幼児検診用に改修する場合

```typescript
// 現在（保健指導）
export interface HealthGuidanceScenario {
  id: string
  name: string
  description: string
  personalInfo: {
    fullName: string
    age: number
    gender: '男性' | '女性'
    occupation: string
    familyStructure: string
    address?: string
  }
  healthCheckResults: {
    date: string
    height: number
    weight: number
    bmi: number
    // ...その他の健康診断データ
  }
  // ...
}

// ↓↓↓ 乳幼児検診用に変更 ↓↓↓

export interface InfantCheckupScenario {
  id: string
  name: string  // 例：「田中太郎（生後6ヶ月）」
  description: string  // 例：「発育は順調だが、離乳食に不安を持つ母親」
  infantInfo: {
    fullName: string
    birthDate: string
    ageInMonths: number  // 月齢
    gender: '男児' | '女児'
  }
  parentInfo: {
    motherName: string
    fatherName?: string
    motherAge: number
    familyStructure: string  // 例：「両親、兄（3歳）」
    occupation?: string
  }
  developmentStatus: {
    checkupDate: string
    height: number
    weight: number
    headCircumference: number
    chestCircumference: number
    developmentalMilestones: {
      motor: string[]  // 例：「首すわり完了」「寝返りできる」
      social: string[]  // 例：「人見知りする」「笑顔で反応」
      language: string[]  // 例：「あーうー」「喃語」
    }
  }
  feedingInfo: {
    breastfeeding: boolean
    formula: boolean
    solidFood: {
      started: boolean
      frequency?: string
      concerns?: string[]
    }
  }
  parentConcerns: string[]  // 例：「離乳食の進め方」「夜泣き」
  psychologicalProfile: {
    motherPersonality: string
    responseStyle: '協力的' | '不安が強い' | '無関心' | '過保護'
    motivationLevel: '高' | '中' | '低'
    healthLiteracy: '高' | '中' | '低'
    strengths: string[]
  }
  backgroundStory: string
  guidanceGoals: string[]
  expectedChallenges: string[]
}
```

**修正のポイント**:
- フィールド名を新しいドメインに合わせて変更
- 不要なフィールドは削除、必要なフィールドは追加
- 型の名前も変更（`HealthGuidanceScenario` → `InfantCheckupScenario`）

---

### ステップ2: シナリオデータの作成

**ディレクトリ**: `src/scenarios/`

既存の13個の保健指導シナリオファイルを、新しいドメインのシナリオに置き換えます。

#### 2-1. 既存シナリオファイルの削除

```bash
# すべての既存シナリオファイルを削除
rm src/scenarios/*.ts
```

#### 2-2. 新しいシナリオファイルの作成

**例**: `src/scenarios/cooperative-mother.ts`（協力的な母親）

```typescript
import { InfantCheckupScenario } from '@/types'

export const cooperativeMotherScenario: InfantCheckupScenario = {
  id: 'cooperative-mother',
  name: '田中太郎（6ヶ月・協力的な母親）',
  description: '発育順調。離乳食開始に前向きな母親',
  infantInfo: {
    fullName: '田中太郎',
    birthDate: '2024年4月1日',
    ageInMonths: 6,
    gender: '男児'
  },
  parentInfo: {
    motherName: '田中花子',
    motherAge: 28,
    familyStructure: '両親、本人',
    occupation: '育休中（会社員）'
  },
  developmentStatus: {
    checkupDate: '2024年10月1日',
    height: 68.5,
    weight: 8.2,
    headCircumference: 43.5,
    chestCircumference: 44.0,
    developmentalMilestones: {
      motor: ['首すわり完了', '寝返り両方向可能', 'お座り練習中'],
      social: ['人見知り少し', '笑顔で反応良好', '名前に反応'],
      language: ['喃語豊富', '声のする方を向く']
    }
  },
  feedingInfo: {
    breastfeeding: true,
    formula: false,
    solidFood: {
      started: true,
      frequency: '1日1回（10倍粥小さじ2）',
      concerns: ['進め方がこれでいいか不安', '量はこれで足りているか']
    }
  },
  parentConcerns: [
    '離乳食の進め方',
    'アレルギーが心配',
    '仕事復帰後の授乳との両立'
  ],
  psychologicalProfile: {
    motherPersonality: '真面目で勉強熱心。育児書をよく読む。',
    responseStyle: '協力的',
    motivationLevel: '高',
    healthLiteracy: '高',
    strengths: [
      '育児に前向き',
      '情報収集を積極的に行う',
      '夫の協力が得られる'
    ]
  },
  backgroundStory: '第一子。真面目な性格で育児書を読んで勉強している。離乳食を始めたばかりで、正しい進め方ができているか不安を感じている。職場復帰を控えており、授乳と離乳食のバランスについても相談したいと考えている。',
  guidanceGoals: [
    '離乳食の適切な進め方を理解する',
    'アレルギー予防の正しい知識を得る',
    '仕事復帰後の授乳計画を立てる'
  ],
  expectedChallenges: [
    '情報過多による混乱',
    '完璧主義による過度な不安',
    '仕事との両立への不安'
  ]
}

export default cooperativeMotherScenario
```

**複数のシナリオを作成する例**:
- `cooperative-mother.ts` - 協力的な母親
- `anxious-mother.ts` - 不安が強い母親
- `indifferent-mother.ts` - 無関心な母親
- `overprotective-mother.ts` - 過保護な母親
- `premature-baby.ts` - 早産児のケース
- など...

#### 2-3. index.tsの更新

**ファイル**: `src/scenarios/index.ts`

```typescript
import { InfantCheckupScenario } from '@/types'

// すべてのシナリオをインポート
import { cooperativeMotherScenario } from './cooperative-mother'
import { anxiousMotherScenario } from './anxious-mother'
// ... 他のシナリオも同様にインポート

// 利用可能なシナリオのリスト
export const AVAILABLE_SCENARIOS = [
  {
    id: 'cooperative-mother',
    name: '田中太郎（6ヶ月・協力的な母親）',
    description: '発育順調。離乳食開始に前向きな母親'
  },
  {
    id: 'anxious-mother',
    name: '佐藤花子（3ヶ月・不安が強い母親）',
    description: '初めての育児で不安が強く、些細なことでも心配する母親'
  },
  // ... 他のシナリオ
] as const

export type ScenarioId = typeof AVAILABLE_SCENARIOS[number]['id']

// シナリオマップ
const SCENARIO_MAP: Record<ScenarioId, InfantCheckupScenario> = {
  'cooperative-mother': cooperativeMotherScenario,
  'anxious-mother': anxiousMotherScenario,
  // ... 他のシナリオ
}

// シナリオをロードする関数
export function loadScenario(scenarioId: ScenarioId): InfantCheckupScenario | null {
  const scenario = SCENARIO_MAP[scenarioId]
  if (!scenario) {
    console.warn(`Unknown scenario ID: ${scenarioId}`)
    return null
  }
  return scenario
}

// シナリオ情報を取得
export function getScenarioInfo(scenarioId: ScenarioId) {
  return AVAILABLE_SCENARIOS.find(scenario => scenario.id === scenarioId) || null
}

// すべてのシナリオ情報を取得
export function getAllScenarioInfo() {
  return AVAILABLE_SCENARIOS
}
```

---

### ステップ3: システムプロンプトの修正

**ファイル**: `src/lib/system-prompt.ts`

AIの振る舞いを定義するプロンプトを、新しいドメインに合わせて変更します。

#### 例：乳幼児検診用に変更

```typescript
import { InfantCheckupScenario } from '@/types'

const BASE_PROMPT = `
# あなたの役割

あなたは乳幼児健診を受けに来た保護者（主に母親）です。保健師との面談をシミュレーションします。

# 重要な指示

1. **保護者として振る舞う**
   - あなたは赤ちゃんの保護者（主に母親）です
   - 保健師ではありません
   - 保健師のような専門的なアドバイスはしないでください

2. **自然な会話を心がける**
   - 短い文章で答える（1-3文程度）
   - 日常会話のような自然な言葉遣い
   - 不安や悩みを素直に表現する

3. **一貫性を保つ**
   - 設定されたプロフィールに基づいて回答する
   - 性格や対応スタイルを一貫させる
   - 矛盾した発言をしない

4. **段階的に情報を開示**
   - 最初からすべてを話さない
   - 保健師の質問に応じて情報を出す
   - 信頼関係ができてから深い悩みを打ち明ける
`

export function generateInfantCheckupPrompt(scenario: InfantCheckupScenario): string {
  return `${BASE_PROMPT}

# あなたの設定

## 赤ちゃんの情報
- 名前: ${scenario.infantInfo.fullName}
- 月齢: ${scenario.infantInfo.ageInMonths}ヶ月
- 性別: ${scenario.infantInfo.gender}

## あなた（保護者）の情報
- 名前: ${scenario.parentInfo.motherName}
- 年齢: ${scenario.parentInfo.motherAge}歳
- 家族構成: ${scenario.parentInfo.familyStructure}

## 発育状況
- 身長: ${scenario.developmentStatus.height}cm
- 体重: ${scenario.developmentStatus.weight}kg
- 運動発達: ${scenario.developmentStatus.developmentalMilestones.motor.join('、')}
- 社会性: ${scenario.developmentStatus.developmentalMilestones.social.join('、')}

## 授乳・栄養
- 母乳: ${scenario.feedingInfo.breastfeeding ? 'あり' : 'なし'}
- ミルク: ${scenario.feedingInfo.formula ? 'あり' : 'なし'}
- 離乳食: ${scenario.feedingInfo.solidFood.started ? '開始済み' : '未開始'}
${scenario.feedingInfo.solidFood.started && scenario.feedingInfo.solidFood.frequency ?
  `- 離乳食の頻度: ${scenario.feedingInfo.solidFood.frequency}` : ''}

## あなたの心配事
${scenario.parentConcerns.map(c => `- ${c}`).join('\n')}

## あなたの性格・対応スタイル
- 性格: ${scenario.psychologicalProfile.motherPersonality}
- 対応スタイル: ${scenario.psychologicalProfile.responseStyle}
- 意欲レベル: ${scenario.psychologicalProfile.motivationLevel}
- 健康リテラシー: ${scenario.psychologicalProfile.healthLiteracy}

## 強み
${scenario.psychologicalProfile.strengths.map(s => `- ${s}`).join('\n')}

## 背景
${scenario.backgroundStory}

# 想定される課題
${scenario.expectedChallenges.map(c => `- ${c}`).join('\n')}

# 対応方針

保健師との会話では、以下のように振る舞ってください：

1. 最初は緊張している様子を見せる
2. 保健師が傾聴姿勢を示したら、徐々に心を開く
3. 設定された「対応スタイル」に基づいて反応する
4. 専門用語を使わず、一般的な保護者の言葉遣いで話す
5. 保健師からアドバイスを受けたら、理解したか・納得したかを表現する

# 注意事項

- 保健師の質問には素直に答える
- ただし、信頼関係ができていない段階では表面的な回答にとどめる
- 保健師が共感的・支持的な態度を示したら、より深い悩みを打ち明ける
- 保健師のアドバイスに対して、実行できそうか・難しそうかを正直に伝える
`
}

export const DEFAULT_PROMPT = BASE_PROMPT
```

**修正のポイント**:
- 役割を「保健指導対象者」→「乳幼児の保護者」に変更
- プロフィール情報の項目を新しいドメインに合わせる
- 会話の流れや対応方針を新しいドメインに適した内容に修正

---

### ステップ4: フィードバックプロンプトの修正

**ファイル**: `src/app/api/feedback/route.ts`

面談後のフィードバック生成用プロンプトを修正します。

```typescript
// 現在（保健指導）
const FEEDBACK_PROMPT = `
あなたは経験豊富な保健師の指導者です。
以下の保健指導の会話ログを分析し、指導技術を評価してください。
...
`

// ↓↓↓ 乳幼児検診用に変更 ↓↓↓

const FEEDBACK_PROMPT = `
あなたは経験豊富な保健師の指導者です。
以下の乳幼児健診での保護者支援の会話ログを分析し、支援技術を評価してください。

# 評価の観点

## 1. コミュニケーション技術 (20点)
- 保護者の不安や心配に共感的に対応できているか
- 専門用語を避け、わかりやすい言葉で説明しているか
- 保護者の発言を丁寧に傾聴しているか
- 非言語的メッセージ（励まし、承認）を適切に使用しているか

## 2. アセスメント力 (20点)
- 赤ちゃんの発育状況を適切に把握しているか
- 保護者の育児状況や生活環境を理解しているか
- 保護者の心理状態（不安、疲労など）を察知しているか
- 強みやリソースを見つけられているか

## 3. 情報提供・指導内容 (20点)
- 発育に関する適切な情報を提供しているか
- 月齢に応じた育児のポイントを説明しているか
- エビデンスに基づいた情報を提供しているか
- 保護者の理解度に合わせて説明しているか

## 4. エンパワメント (20点)
- 保護者の自信を高める関わりができているか
- 保護者自身の力を引き出せているか
- 小さな成功体験を認めているか
- 保護者が主体的に考えられるよう支援しているか

## 5. 全体的な印象 (20点)
- 保護者が安心して相談できる雰囲気づくりができているか
- 支援的・協働的な姿勢が感じられるか
- 保護者のペースを尊重しているか
- 継続的な支援の視点があるか
`
```

**修正のポイント**:
- 評価観点を新しいドメインに合わせて変更
- 保健指導→乳幼児健診の文脈に修正
- 評価項目を新しいドメインの専門性に合わせる

---

### ステップ5: UI/テキストの修正

各コンポーネントファイルの表示テキストを修正します。

#### 5-1. ページタイトル

**ファイル**: `src/app/layout.tsx`

```typescript
// 現在
<title>保健指導シミュレーション</title>
<meta name="description" content="AI保健師による保健指導練習アプリ" />

// ↓↓↓ 変更 ↓↓↓
<title>乳幼児健診シミュレーション</title>
<meta name="description" content="AI保護者による乳幼児健診面談練習アプリ" />
```

#### 5-2. PWAマニフェスト

**ファイル**: `public/manifest.json`

```json
{
  "name": "乳幼児健診シミュレーション",
  "short_name": "健診練習",
  "description": "保健師のための乳幼児健診面談練習アプリ"
}
```

#### 5-3. メインページ

**ファイル**: `src/app/page.tsx`

検索して "保健指導" という文字列を "乳幼児健診" に置き換えます。

#### 5-4. コンポーネントのテキスト

以下のファイルで文言を修正：

- `src/components/ResumeSelection.tsx` - シナリオ選択画面
- `src/components/ChatInterface.tsx` - チャット画面
- `src/components/SettingsModal.tsx` - 設定モーダル

**一括置換の例**:
```bash
# VSCodeなどで一括置換
保健指導 → 乳幼児健診
対象者 → 保護者
健康診断 → 乳幼児健診
```

#### 5-5. アイコン・画像の置き換え

**ディレクトリ**: `public/`

現在の画像：
- `himan_pocchari07_ojisan.png` - おじさんのアイコン
- `himan_pocchari08_obasan.png` - おばさんのアイコン

これらを赤ちゃんや保護者のアイコンに置き換えます。

---

### ステップ6: ドキュメントの更新

#### 6-1. README.md

```markdown
# 📱 乳幼児健診シミュレーション

保健師のための乳幼児健診面談練習アプリ

## 🚀 特徴

- 🎯 **AI乳幼児健診練習**: リアルなシナリオベースの模擬面談
- 👶 **多様な保護者**: 10種類の保護者シナリオ（協力的・不安が強い・無関心など）
- 📊 **詳細な設定**: 発育状況、授乳・栄養、保護者の心理プロフィール
...
```

#### 6-2. CLAUDE.md

アーキテクチャ概要や開発時の注意事項を新しいドメインに合わせて更新します。

#### 6-3. 使い方.md

アプリの使い方ガイドを新しいドメインに合わせて更新します。

---

## ✅ 改修チェックリスト

改修が完了したか確認するためのチェックリストです。

### データ・ロジック層
- [ ] `src/types/index.ts` - 型定義を新しいドメインに変更
- [ ] `src/scenarios/` - 全シナリオファイルを新規作成
- [ ] `src/scenarios/index.ts` - インポート/エクスポート更新
- [ ] `src/lib/system-prompt.ts` - AIプロンプト修正
- [ ] `src/app/api/feedback/route.ts` - フィードバックプロンプト修正

### UI層
- [ ] `src/app/layout.tsx` - タイトル・メタデータ更新
- [ ] `src/app/page.tsx` - 表示テキスト修正
- [ ] `src/components/ResumeSelection.tsx` - テキスト修正
- [ ] `src/components/ChatInterface.tsx` - テキスト修正
- [ ] `src/components/ResumeModal.tsx` - 表示項目の調整
- [ ] `src/components/SettingsModal.tsx` - テキスト修正
- [ ] `public/manifest.json` - PWA情報更新
- [ ] `public/` - アイコン・画像置き換え

### ドキュメント
- [ ] `README.md` - 内容更新
- [ ] `CLAUDE.md` - 内容更新
- [ ] `使い方.md` - 内容更新
- [ ] `起動.bat` / `起動.command` - タイトル修正（任意）

### 動作確認
- [ ] ビルドが通るか (`npm run build`)
- [ ] 開発サーバーが起動するか (`npm run dev`)
- [ ] シナリオ一覧が表示されるか
- [ ] シナリオ詳細が表示されるか
- [ ] 面談が開始できるか
- [ ] AIが適切に応答するか
- [ ] フィードバック機能が動作するか

---

## 💡 改修のヒント

### 1. 段階的に進める

一度にすべてを変更せず、以下の順序で進めることをおすすめします：

1. **型定義の変更** - データ構造を決める
2. **1つのシナリオを作成** - サンプルとして動作確認
3. **プロンプトの修正** - AIの振る舞いを調整
4. **残りのシナリオを作成** - パターンが見えたら量産
5. **UI/テキストの修正** - 最後に見た目を整える

### 2. TypeScriptのエラーを活用

型定義を変更すると、TypeScriptが関連する修正箇所をエラーで教えてくれます。
これを活用して、修正漏れを防ぎましょう。

### 3. 既存コードを参考に

新しいシナリオを作成する際は、既存のシナリオファイルをコピーして、
内容だけを変更すると効率的です。

### 4. プロンプトのテスト

システムプロンプトを変更したら、実際にAIと会話してみて、
期待通りの振る舞いをするか確認しましょう。

### 5. 一括置換の活用

VSCodeなどのエディタの「ファイル内検索・置換」機能を使うと、
文言の変更を効率的に行えます。

---

## 🔍 よくある質問

### Q1: シナリオは何個くらい作ればいい？

**A**: 最低3-5個あれば練習用として機能します。多様性を持たせるため、
以下のような分類で作成することをおすすめします：

- 協力的なケース（1-2個）
- 困難なケース（2-3個）
- 特殊なケース（1-2個）

### Q2: プロンプトの調整が難しい

**A**: まずは既存のプロンプト構造を保ちつつ、文言だけを変更してください。
動作確認後、必要に応じて細かく調整していきましょう。

### Q3: 型定義のフィールドをどこまで変更すべき？

**A**: 新しいドメインに必要な情報を中心に設計してください。
ただし、以下のフィールドは残すことをおすすめします：

- `id`, `name`, `description` - シナリオの基本情報
- `psychologicalProfile` - AIの振る舞いを制御するために重要
- `backgroundStory` - AIが一貫性を保つために重要
- `guidanceGoals`, `expectedChallenges` - フィードバック生成に使用

### Q4: UIの大幅な変更は必要？

**A**: 基本的なUI構造（チャット形式）はそのまま使えます。
文言を変更するだけで十分機能します。

---

このガイドに従って改修を進めれば、別の指導練習用アプリへの転用が可能です。
不明点があれば、お気軽にお問い合わせください！
